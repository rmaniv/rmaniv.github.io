<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Vinamr Sachdeva">
<meta name="dcterms.date" content="2022-10-08">

<title>Vinamr Sachdeva - Are epidemic fatalities ‘extremely fat-tailed’?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Vinamr Sachdeva</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/vinamrsachdeva" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/vinamrsachdeva" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://old.reddit.com/u/vinamrsachdeva" rel="" target=""><i class="bi bi-reddit" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:vinamrsachdeva@gmail.com" rel="" target=""><i class="bi bi-envelope" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Are epidemic fatalities ‘extremely fat-tailed’?</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">covid</div>
                <div class="quarto-category">fat-tails</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Vinamr Sachdeva </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 8, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#fat-tails-imply-existential-risk" id="toc-fat-tails-imply-existential-risk" class="nav-link active" data-scroll-target="#fat-tails-imply-existential-risk"><span class="header-section-number">1</span> Fat tails imply existential risk</a></li>
  <li><a href="#issues-with-cirillo-and-talebs-dataset" id="toc-issues-with-cirillo-and-talebs-dataset" class="nav-link" data-scroll-target="#issues-with-cirillo-and-talebs-dataset"><span class="header-section-number">2</span> Issues with Cirillo and Taleb’s dataset</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p><em>Disclaimer: I’m not formally trained in statistics. I’m not good at math. I’m just trying to understand what the debate is about. I might have made some errors. It’d be great if anyone of you could help me understand where I’m wrong.</em></p>
<section id="fat-tails-imply-existential-risk" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="fat-tails-imply-existential-risk"><span class="header-section-number">1</span> Fat tails imply existential risk</h2>
<p>The ultra-precautionary approach is usually <a href="https://necsi.edu/systemic-risk-of-pandemic-via-novel-pathogens-coronavirus-a-note">justified</a> by the claim that epidemics are “extemely <a href="https://en.wikipedia.org/wiki/Fat-tailed_distribution">fat-tailed</a>”. What that means is that extreme outcomes, which in this case are epidemics with high death counts, are much more frequent than say what you would observe if it was a <a href="https://en.wikipedia.org/wiki/Normal_distribution">normal distribution</a>.</p>
<p><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa6f86a4a-70d5-419d-b39f-7618ec3c93e9_930x584.png" class="img-fluid"></p>
<p align="center" style="color:grey;">
<b>Figure 1</b> Cirillo, P., Taleb, N.N. Tail risk of contagious diseases. Nat. Phys.&nbsp;16, 606–613 (2020). <a href="https://www.google.com/url?q=https://doi.org/10.1038/s41567-020-0921-x&amp;sa=D&amp;source=editors&amp;ust=1684500177224599&amp;usg=AOvVaw1rA6Y8k-2fagtSDCO8PZ7c">https://doi.org/10.1038/s41567-020-0921-x</a>
</p>
<p>This histogram shows the number of epidemics from a historical dataset of 72 epidemics from (y-axis) for each casualty toll (x-axis). It shows that&nbsp;there are many epidemics with high casualties and the function doesn’t die down easily to 0.</p>
<p><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb09c878a-e723-4b71-bef9-e617e0b67664_954x622.png" class="img-fluid"></p>
<p align="center" style="color:grey;">
<b>Figure 2</b> Nassim Nicholas Taleb, Yaneer Bar-Yam, Pasquale Cirillo. On single point forecasts for fat-tailed variables. International Journal of Forecasting. Volume 38, Issue 2. 2022. Pages 413-422. ISSN 0169-2070. <a href="https://www.google.com/url?q=https://doi.org/10.1016/j.ijforecast.2020.08.008&amp;sa=D&amp;source=editors&amp;ust=1684500177225237&amp;usg=AOvVaw3cYa0u83VrXalPNQHKVPJL">https://doi.org/10.1016/j.ijforecast.2020.08.008</a>.
</p>
<p>Based on Figure 1, we can see that it is similar to the following <a href="https://www.google.com/url?q=https://en.wikipedia.org/wiki/Pareto_distribution&amp;sa=D&amp;source=editors&amp;ust=1684500177221858&amp;usg=AOvVaw3Dt2o2SMbrowooBcdde8Y4">Pareto distribution</a>. The mean&nbsp;of such functions is so far away that you cannot observe it. This means that the risk from an epidemic is apparently infinite. Since Cirillo and Taleb (2020) use a dataset with more than 1000 fatalities, it shows that if you have an outbreak with more than 1000 fatalities, you should assume infinite risk and take measures accordingly. This is what Norman, Bar-Yam and Taleb write in their January 2020 <a href="https://necsi.edu/systemic-risk-of-pandemic-via-novel-pathogens-coronavirus-a-note">paper</a> to call for “a precautionary approach to current and potential pandemic outbreaks that must include <strong>constraining mobility patterns in the early stages of an outbreak</strong>”:</p>
<blockquote class="blockquote">
<p>The general (non-naive) precautionary principle [3] delineates conditions where actions must be taken to reduce risk of ruin, and traditional cost-benefit analyses must not be used. These are ruin problems where, over time, exposure to tail events leads to a certain eventual extinction. While there is a very high probability for humanity surviving a single such event, over time, there is eventually zero probability of surviving repeated exposures to such events. While repeated risks can be taken by individuals with a limited life expectancy, ruin exposures must never be taken at the systemic and collective level. In technical terms, the precautionary principle applies when traditional statistical averages are invalid because risks are not ergodic.</p>
</blockquote>
</section>
<section id="issues-with-cirillo-and-talebs-dataset" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="issues-with-cirillo-and-talebs-dataset"><span class="header-section-number">2</span> Issues with Cirillo and Taleb’s dataset</h2>
<p>Cirillo and Taleb (2020) used 72 epidemics in the last 2,500 years with more than 1,000 fatalities to show that the distribution of fatalities is strongly fat-tailed. Apparently this dataset comes from a <a href="https://en.wikipedia.org/wiki/List_of_epidemics">Wikipedia article</a> and a couple of <a href="https://www.ancient.eu/article/1528/plague-in-the-ancient--medieval-world/">online</a> <a href="https://listfist.com/list-of-epidemics-compared-to-coronavirus-covid-19">encyclopedias</a>. When confronted that their study, being based on 72 most-noticed epidemics, would suffer from selection bias by <a href="https://forecasters.org/wp-content/uploads/Ioannidisetal_03082020-1.pdf">Ioannidis et al (2020)</a> because epidemics with higher fatalities would have a higher probability of being noticed and recorded in historical records, <a href="https://forecasters.org/wp-content/uploads/Talebetal_25062020.pdf">Taleb et al (2020)</a> defend by saying that Cirillo and Taleb’s “dataset likely contains most (if not all) of them.” This, of course, doesn’t look like a reasonable justification. Here is an excerpt from Ioannidis et al that’ll further make their contention with Cirillo and Taleb clear:</p>
<blockquote class="blockquote">
<p>For example, according to their dataset, the first epidemic originating from sub-Saharan Africa did not occur until 1920 AD, namely HIV/AIDS. The most famous outbreaks in human history are preferentially selected from the extreme tail of the distribution of all outbreaks. Tens of millions of outbreaks with a couple deaths must have happened throughout time. Probably hundreds of thousands might have claimed dozens of fatalities. Thousands of outbreaks might have exceeded 1,000 fatalities. Most eluded the historical record. The four garden variety coronaviruses may be causing such outbreaks every year.20,21 One of them, OC43 seems to have been introduced in humans as recently as 1890, probably causing a “bad influenza year” with over a million deaths.22 Based on what we know now, SARS-CoV-2 may be closer to OC43 than SARS-CoV-1. This does not mean it is not serious: its initial human introduction can be highly lethal, unless we protect those at risk.</p>
</blockquote>
<p>Here’s an <a href="https://history.stackexchange.com/questions/70025/does-talebs-claim-of-epidemics-with-a-death-count-of-1-000-being-in-the-lower">answer</a> from History Stackexchange that’ll further support Ioannidis et al’s point:</p>
<blockquote class="blockquote">
<p>[…]</p>
<p>Instinctively, I have some doubts. Cirillo’s list is (as noted in comments) heavily sourced from Wikipedia’s list of epidemics; I make it 55/72 (56 with one dual-cited). Ten more are cited to <a href="https://listfist.com/list-of-epidemics-compared-to-coronavirus-covid-19">a page</a> on “ListFist”, which itself seems to be citing back to the same Wikipedia list. and then there are a couple of sources used once or twice. The WP list <a href="https://en.wikipedia.org/w/index.php?title=List_of_epidemics&amp;oldid=948244249">as of March 2020</a> is interesting - comparing it to the one in the article, it looks like they have mostly just skipped ones with no quoted death toll. For example, in the “15th century and earlier” section, WP includes an unknown death rate plague in 412 BC, and in 746 AD, neither of which are shown here (though they do include the 664 British plague, which WP had a blank death toll for).</p>
<p>So, some immediate problems appear. Firstly, the Wikipedia article does not claim to be comprehensive (later versions do misleadingly say “a list of the largest”, but this is not in the 2020 version), but they seem to have assumed it was.</p>
<p>Secondly, it is trivial to follow the sources <em>in Wikipedia</em> and find a death toll well in excess of 1000 for some of those “blank” ones. For example, the <a href="https://academic.oup.com/jsh/article/45/3/809/1746067">cited source</a> for the 1636 English plague gives a reasonably precise figure of 10,400 in its introductory paragraph, and mentions other outbreaks in 1603 and 1625 - 1603 but not 1625 is mentioned in Wikipedia, neither in Cirillo. It turns out 1625 killed 26,350 people per a footnote in that article; 1603 “<a href="https://www.jstor.org/stable/43447603">over thirty thousand</a>”. We’ve just extended the list by 4%, just with one country in a 33-year period.</p>
<p>Thirdly, just looking at Cirillo’s list, the distribution is striking. Up to the mid-sixth-century AD, they are all in the Mediterranean world; 562, 627, 688 are in Mesopotamia; 664 in Britain; 735 is the first in Asia proper. Then nothing until the Black Death in the fourteenth century. It seems vanishingly unlikely that, to pick some of the obvious points:</p>
<ul>
<li><ol type="a">
<li>China or India - which had a population in the tens of millions - did not have any substantial epidemic outbreaks for most of its history;</li>
</ol></li>
<li><ol start="2" type="a">
<li>There was only one major epidemic outbreak pre-1 AD;</li>
</ol></li>
<li><ol start="3" type="a">
<li>There were none in the early Mesopotamian civilisations or in ancient Egypt;</li>
</ol></li>
<li><ol start="4" type="a">
<li>There were none in Europe or the Mediterranean for most of the medieval period;</li>
</ol></li>
</ul>
<p>On that first point, in a comment above I mentioned McNeil’s <em><a href="https://archive.org/details/plaguespeoples00will">Plagues and Peoples</a></em> (1976). It has an appendix of epidemics recorded in Chinese sources; at a guess, there are around 200. These include what appear to be very major epidemics (killing a substantial proportion of the population in some provinces) in 312, 322, 413, 468, 682, 707, 762, 806… and those are just the ones with relative death tolls noted. It would be challenging to calculate numbers for an analysis like this one, granted, but it seems hard to just dismiss them from consideration because no estimate is available.</p>
<hr>
<p>Update: skimming the papers citing the original Cirillo paper, we find <em><a href="https://www.pnas.org/doi/abs/10.1073/pnas.2105482118">Intensity and frequency of extreme novel epidemics</a></em> (PNAS, 2021), which offers a dataset that they have compiled.</p>
<p>“In summary, the 1600 to 1945 dataset includes 182 epidemics with known occurrence, duration, and number of deaths, 108 known to have caused less than 10,000 deaths, and 105 for which only occurrence and duration are recorded, for a total of 395 epidemics.”</p>
<p>So that gives us almost 200 identified in a 350 year period with over 10,000 deaths, plus an indeterminate number of deaths unknown - well in excess of the original figure</p>
</blockquote>
<p>(I have replaced block quotes of the original text with double quotation marks and made some minor changes in formatting.)</p>
<p>I think this makes it extremely clear that Cirillo and Taleb massively undercounted epidemics that passed their own threshold and the statement of Taleb et al (2020) that “dataset likely contains most (if not all) of them” is false since I could find more epidemics that were not included in their dataset than were, which means that the dataset doesn’t contain most, let alone all, of them.</p>
<p>In addition, I found <a href="https://journals.aps.org/pre/abstract/10.1103/PhysRevE.103.022315">Corral (2021)</a> that discusses the incompleteness of the dataset used by Cirillo and Taleb extensively:</p>
<blockquote class="blockquote">
<p><strong>II. DATA AND COMPLETENESS</strong></p>
<p>Most of the events analyzed in Ref. [6] come from the Wikipedia list of the largest known epidemics caused by in- fectious diseases [16]. The list was complemented with a few more events, obtained from other sources (mainly Ref. [17]). Restricting to epidemics causing 1000 or more fatalities, this led to <em>N</em> = 72 events, from 429 BC to 2020 AD (CE); the resulting data are provided in Table 1 of Ref. [6], in concrete, in the fourth numeric column (average estimate). We will refer to these data as the original data set.</p>
<p>We are not aware of any study of completeness of such data. In order to address this important point, we display the number of fatalities versus time of occurrence (beginning of the outbreak) in Fig. 1(a), where it can be clearly seen that the data look certainly inhomogeneous. For example, between 735 AD (Japanese smallpox epidemic) and 1485 AD there is only one event, which happens to be the Black Death (largest event on record, with roughly 140 000 000 fatalities, starting in 1331).</p>
<p>Figure 1(b) confirms that the rate of occurrence of large epidemics seems to be highly inhomogeneous, from roughly three per century between 500 and 750 AD to just one in seven centuries (up to 1485) and to about 0.5 per year after 2000 AD. We associate this high variability mainly to the large incompleteness of the data and not to a wild variation of the occurrence of epidemics over the centuries.</p>
<p>Incompleteness can also be seen in the uneven distribution of the smallest events considered, i.e., out of the 17 epidemics below 10 000 fatalities, only two are contained in the first half of the data (from 429 BC to 1813). Including events be- low the completeness threshold can lead to important biases.</p>
<p>Although in Ref. [6] it is claimed that a Jackknife resampling technique can account for incompleteness, it is obvious that resampling does not correct any bias present in the data (one must not get confused by the fact that Jackknife corrects the bias of an estimator, which is clearly different from the bias arising from data incompleteness).</p>
<p>For this reason, in order to evaluate the impact of data incompleteness, in addition to analyze the raw data used in Ref. [6], we also consider a restricted data set, from 1485 to 2000 AD, which shows a higher homogeneity, with an average of 0.1 epidemics per year. This restricted data set consists of <em>N</em> = 50 epidemics. Note that the largest event, the Black Death, is not contained in this data set; thus, this provides a way to test the robustness of the results in front of the value of the most extreme event. This also eliminates ongoing epidemics (such as the COVID-19) from the analysis (except the HIV/AIDS pandemic).</p>
<p>A third data set, considered in Ref. [6], consists of rescaling the number of fatalities (of the original data set) by the entire world population at the time of the epidemic. This represents a procedure to take into account that the world population is far from stationary across history, and it is not the same to have 140 million of fatalities nowadays than in the Middle Ages (when the global population was around 400 million).</p>
<p>However, it is questionable why one should rescale by the world population and not by the local population (i.e., the population of Greece for the plague of Athens), and also why the scaling is linear with the total world population (for instance, in a simple branching process the size does not scale linearly with the size of the underlying tree, but with the square of the number of generations [18], and in general one has to take into account the so-called fractal dimension of the avalanches; see, e.g., Ref. [19]). Nevertheless, we will also explore this simple rescaled data set in order to test the robustness of the results.</p>
</blockquote>
<p>Corral (2021) shows that the distribution of epidemic fatalities is equally well described by the <a href="https://www.google.com/url?q=https://en.wikipedia.org/wiki/Log-normal_distribution&amp;sa=D&amp;source=editors&amp;ust=1684500177223031&amp;usg=AOvVaw3oQoWIAHL1H4TV9XuFXgME">Log-normal</a> distribution as the Pareto distribution. The Log-normal distribution, as shown in Figure 3, has a <a href="https://www.google.com/url?q=https://en.wikipedia.org/wiki/Heavy-tailed_distribution&amp;sa=D&amp;source=editors&amp;ust=1684500177223485&amp;usg=AOvVaw0yIMdkWI9BEuJ7_OcnS_Du">milder</a>&nbsp;tail than the Pareto distribution, so finding the mean is possible. 85% of observations fall below the mean. Half the observations fall below 13% of the mean. If this is true, it shows that (unlike what Cirillo &amp; Taleb (2020) suggest) the risk is not apparently infinite and something that public health can prepare for with greater certainty than if what Cirillo and Taleb concluded was true.</p>
<p><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9d5b88f9-c9b4-4dda-bd86-4240f164af20_774x526.png" class="img-fluid"></p>
<p align="center" style="color:grey;">
<b>Figure 3</b> Nassim Nicholas Taleb, Yaneer Bar-Yam, Pasquale Cirillo. On single point forecasts for fat-tailed variables. International Journal of Forecasting. Volume 38, Issue 2. 2022. Pages 413-422. ISSN 0169-2070. <a href="https://www.google.com/url?q=https://doi.org/10.1016/j.ijforecast.2020.08.008&amp;sa=D&amp;source=editors&amp;ust=1684500177225237&amp;usg=AOvVaw3cYa0u83VrXalPNQHKVPJL">https://doi.org/10.1016/j.ijforecast.2020.08.008</a>.
</p>
<p>I’ve only touched the issues with the reliability of the dataset used to promote the idea that epidemics are fat-tailed but there are several other interesting issues around this debate which I may discuss in future posts.</p>
<script src="https://utteranc.es/client.js" repo="vinamrsachdeva/vinamrsachdeva.github.io" issue-term="pathname" label="comments" theme="github-light" crossorigin="anonymous" async="">
</script>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>